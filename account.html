/* config.js - 全局配置中心 */

// 1. 定义全局配置 (挂在 window 上，防止报错)
window.CONFIG = {
    // 后端 API 地址 (本地开发用 localhost:3000)
    API_BASE_URL: 'http://localhost:3000',
    
    // 默认头像 (Base64 灰色人像，不需要联网，永远不裂)
    DEFAULT_AVATAR: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2UzZTNlMyI+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PGNpcmNsZSBjeD0iMTIiIGN5PSI4IiByPSI0IiBmaWxsPSIjOWNhM2FmIi8+PHBhdGggZD0iTTEyIDE0Yy02LjEgMC04IDQtOCA0djJoMTZ2LTJzLTEuOS00LTgtNHoiIGZpbGw9IiM5Y2EzYWYiLz48L3N2Zz4='
};

// 2. 定义全局图片处理函数
window.getFullImageUrl = function(path) {
    // 情况A: 没有路径，或者路径包含那个被墙的国外网站 -> 返回默认图
    if (!path || path.includes('via.placeholder.com')) {
        return window.CONFIG.DEFAULT_AVATAR;
    }
    
    // 情况B: 已经是 Base64 或者 完整链接 (http开头) -> 直接用
    if (path.startsWith('data:') || path.startsWith('http')) {
        return path;
    }
    
    // 情况C: 本地上传的图片 (uploads开头) -> 拼接 API 地址
    // 确保前面有斜杠
    const cleanPath = path.startsWith('/') ? path : '/' + path;
    return window.CONFIG.API_BASE_URL + cleanPath;
};

console.log("✅ Config loaded. API:", window.CONFIG.API_BASE_URL);
